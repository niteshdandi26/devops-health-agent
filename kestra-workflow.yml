id: devops-health-monitor
namespace: production
description: AI-powered DevOps health monitoring

triggers:
  - id: schedule
    type: io.kestra.plugin.core.trigger.Schedule
    cron: "*/10 * * * *"

tasks:
  - id: sample_log
    type: io.kestra.plugin.core.log.Log
    message: |
      ğŸ“‹ Analyzing error logs with AI...

  - id: analyze
    type: io.kestra.plugin.core.http.Request
    uri: "http://192.168.1.6:8000/analyze"
    method: POST
    contentType: application/json
    body: |
      {
        "logs": "[2024-12-10 08:32:54] ERROR: Database connection failed\n[2024-12-10 08:32:54] ERROR: Connection timeout after 30s"
      }

  - id: show_results
    type: io.kestra.plugin.core.log.Log
    message: |
      
      â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
      â•‘           ğŸ¤– AI AGENT ANALYSIS RESULTS                    â•‘
      â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      ğŸ“Š STATUS: {{ json(outputs.analyze.body).status }}
      ğŸ¤– MODEL: {{ json(outputs.analyze.body).model }}
      âš¡ PROVIDER: {{ json(outputs.analyze.body).provider }}
      
      âŒ ERROR DETECTED:
         {{ json(outputs.analyze.body).analysis.error }}
      
      ğŸ” ROOT CAUSE:
         {{ json(outputs.analyze.body).analysis.cause }}
      
      ğŸ’¡ RECOMMENDED SOLUTION:
         {{ json(outputs.analyze.body).analysis.solution }}
      
      âš ï¸  SEVERITY LEVEL: {{ json(outputs.analyze.body).analysis.severity }}
      
      â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      Analysis completed at {{ json(outputs.analyze.body).timestamp }}
