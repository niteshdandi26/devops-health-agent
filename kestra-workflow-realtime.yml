id: devops-health-monitor-realtime
namespace: production
description: Real-time AI-powered DevOps health monitoring with dynamic data

triggers:
  - id: schedule
    type: io.kestra.plugin.core.trigger.Schedule
    cron: "*/10 * * * *"  # Every 10 minutes

tasks:
  - id: start_log
    type: io.kestra.plugin.core.log.Log
    message: |
      ğŸš€ Starting real-time health check...
      â° Time: {{ trigger.date }}

  # Fetch real-time logs from your API
  - id: fetch_logs
    type: io.kestra.plugin.core.http.Request
    uri: "https://YOUR-BACKEND-URL.vercel.app/generate-logs"
    method: GET

  - id: log_source
    type: io.kestra.plugin.core.log.Log
    message: |
      ğŸ“Š Fetched logs from: {{ json(outputs.fetch_logs.body).source }}
      ğŸ• Timestamp: {{ json(outputs.fetch_logs.body).timestamp }}

  # Send to AI for analysis
  - id: analyze
    type: io.kestra.plugin.core.http.Request
    uri: "https://YOUR-BACKEND-URL.vercel.app/analyze"
    method: POST
    contentType: application/json
    body: |
      {
        "logs": "{{ json(outputs.fetch_logs.body).logs }}"
      }

  # Display results
  - id: show_results
    type: io.kestra.plugin.core.log.Log
    message: |
      
      â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
      â•‘           ğŸ¤– REAL-TIME AI ANALYSIS RESULTS                â•‘
      â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      ğŸ“¡ DATA SOURCE: {{ json(outputs.fetch_logs.body).source }}
      ğŸ“Š STATUS: {{ json(outputs.analyze.body).status }}
      ğŸ¤– MODEL: {{ json(outputs.analyze.body).model }}
      âš¡ PROVIDER: {{ json(outputs.analyze.body).provider }}
      
      âŒ ERROR DETECTED:
         {{ json(outputs.analyze.body).analysis.error }}
      
      ğŸ” ROOT CAUSE:
         {{ json(outputs.analyze.body).analysis.cause }}
      
      ğŸ’¡ RECOMMENDED SOLUTION:
         {{ json(outputs.analyze.body).analysis.solution }}
      
      âš ï¸  SEVERITY LEVEL: {{ json(outputs.analyze.body).analysis.severity }}
      
      â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      Analysis completed at {{ json(outputs.analyze.body).timestamp }}
      
      âœ… Next check in 10 minutes...
